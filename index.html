<!DOCTYPE html>
<html lang="eng">
    <head>
        
        <link rel="stylesheet" type="text/css" href="style.css">
        <div id="map"></div>
        <script src = "https://d3js.org/d3.v4.min.js"></script>
        <script src="http://maps.google.com/maps/api/js?"></script>
    </head>

    <body>
        Hello world !
    </body>

    <script>

        const MIN_ZOOM_LEVEL = 5;
        const MIN_RADIUS = 4;
        const MAX_RADIUS = 30;

        var map = new google.maps.Map(
            d3.select('#map').node(),
            {
                zoom: MIN_ZOOM_LEVEL,
                center: new google.maps.LatLng(49.7, 17.2),
                mapTypeId: google.maps.MapTypeId.TERRAIN
            });

        var strictBounds = new google.maps.LatLngBounds(
            new google.maps.LatLng(39, -6),
            new google.maps.LatLng(53, 35)
        );
        
        /* Move the map back to the bounds when we are out of bounds. */
        google.maps.event.addListener(map, 'dragend', () => {
            if(strictBounds.contains(map.getCenter())) return;

            // We are out of bounds, move the map back to the bounds.

            var center = map.getCenter(),
                x = center.lng(),
                y = center.lat(),
                maxX = strictBounds.getNorthEast().lng(),
                maxY = strictBounds.getNorthEast().lat(),
                minX = strictBounds.getSouthWest().lng(),
                minY = strictBounds.getSouthWest().lat();

            if(x < minX) x = minX;
            if(x > maxX) x = maxX;
            if(y < minY) y = minY;
            if(y > maxY) y = maxY;

            map.setCenter(new google.maps.LatLng(y, x));
        });

        // Limit the zoom level
        google.maps.event.addListener(map, 'zoom_changed', function() {
            if (map.getZoom() < MIN_ZOOM_LEVEL) {
                map.setZoom(MIN_ZOOM_LEVEL);
                console.log('Back to min zoom level');
            }
        });

        
        google.maps.event.addListenerOnce(map, 'bounds_changed', function(event) {
        if (map.getZoom() < MIN_ZOOM_LEVEL) {
            map.setZoom(MIN_ZOOM_LEVEL);
        }
        });

        d3.json("./datasets/countries.json", function(error, data) {
            d3.json("./datasets/euro2016_players_dataset.json", function(error, data2) {

                if(error) throw error;

                var overlay = new google.maps.OverlayView();

                overlay.onAdd = function() {
                    var layer = d3.select(this.getPanes().overlayLayer).append("div")
                        .attr("class", "stations");
                    
                    //console.log(data);
                    // Draw each marker as a separate SVG element.
                    // We could use a single SVG, but what size would it have?
                    overlay.draw = function() {
                        var projection = this.getProjection(),
                            padding = 40;

                        var marker = layer.selectAll("svg")
                            .data(d3.entries(data))
                            .each(transform) // update existing markers
                            .enter()
                            .append("svg")

                        // Add a circle.
                        marker.append("circle")
                            .attr("r", radius)
                            .attr("cx", padding)
                            .attr("cy", padding);

                        function transform(d) {
                            d = new google.maps.LatLng(d.value.latitude, d.value.longitude);
                            d = projection.fromLatLngToDivPixel(d);
                            return d3.select(this)
                                .style("left", (d.x - padding) + "px")
                                .style("width", "100px")
                                .style("height", "100px")
                                .style("top", (d.y - padding) + "px")
                                .style("padding-right", 0 + "px");

                        }

                        function radius(numGoals) {
                            return MAX_RADIUS;
                        }
                    };
                };

                // Bind our overlay to the mapâ€¦
                overlay.setMap(map);

            });
        });

        

    </script>
</html>