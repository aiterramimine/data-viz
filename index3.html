<!DOCTYPE html>
<html lang="fr">
    <head>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src = "https://d3js.org/d3.v4.min.js"></script>
    </head>

    <body>
    <div>
        <p>Visualisation par Postes du football</p>
        <h3 id="team"></h3>
        <p>Schémas tactiques</p>
        <form id="tactiques">
            <input type="radio" id="4-4-2" name="formation" checked>4-4-2
            <input type="radio" id="4-3-3" name="formation" disabled>4-3-3
            <input type="radio" id="4-5-1" name="formation" disabled>4-5-1
            <input type="radio" id="5-3-2" name="formation" disabled>5-3-2
            <input type="radio" id="3-5-2" name="formation" disabled>3-5-2
            <input type="radio" id="5-4-1" name="formation" disabled>5-4-1
        </form>
        <div id="chooseTactique"></div>

        <p>Choix Equipe</p>
        <div id="choose"></div>
        <svg id="position" width="100%" height="760"></svg>
        <svg id="graph"></svg>
    </div>
    </body>

    <script>
        var dataset = "./datasets/euro2016_players_dataset.json";
        var tactique = "";

        var form = document.getElementById("tactiques");

        var initTerrain = function () {
            d3.select("#position").append("image")
                .attr("xlink:href", "./img/terrain.svg")
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", 500)
                .attr("height", 700)
                .attr("fill", "#1b5e20")
                .attr("stroke", "#fff")
                .attr("stroke-width", 2);
        };

        d3.json(dataset, function (data) {
            d3.json("./datasets/fifa18dataset.json", function (data2) {
                console.log("[TAILLE] "+data2.length);
                for (let i = 0; i < data2.length; i++) {
                    let n = "Ramazan Özcan";
                    let a = n.split(" ")[0];
                    if (data2[i].Name === n.replace(a, a.split("")[0]+".")) {
                        console.log("[TROUVE] "+data2[i].Name);
                    }
                }

            var tabData = ["-- Selection pays --"];
            var tabDataTactic = ["4-3-3"];
            tabDataTactic.push("Coucou");
            tabDataTactic.push("Coucou1");
            tabDataTactic.push("Coucou2");

            for (var i = 0; i < data.length; i++) {
                var object = data[i];
                for (var obj in object) {
                    tabData.push(obj);
                }
            }

            var checkBox = d3.select("#tactiques")
                .on("change", onChange);

            var select = d3.select("#choose")
                .append('select')
                .attr('class', 'select')
                .on('change', onChange);

            var options = select.selectAll('option')
                .data(tabData)
                .enter()
                .append('option')
                .text(function (d) {
                    return d;
                });

            function onChange() {
                var listGoalkeeper = [];
                for (var i = 0; i < form.length; i++) {
                    if (form[i].checked) {
                        tactique = form[i].id;
                    }
                }
                console.log("tactique = "+tactique);

                selectValue = d3.select('select').property('value');
                d3.selectAll('text').remove();
                d3.selectAll('image').remove();
                if (selectValue !== "-- Selection pays --" ) {
                    d3.select('body').select('#team').text(selectValue);
                    initTerrain();

                    for (var i = 0; i < data.length; i++) {
                        var object = data[i];
                        for (var obj in object) {
                            if (obj === selectValue) {
                                for (var j = 0; j < object[obj].Players.length; j++) {
                                    console.log("========> "+object[obj].Players[j].position);
                                    switch (object[obj].Players[j].position) {
                                        case "Goalkeeper":
                                            var ooo = object[obj].Players[j];
                                            listGoalkeeper.push(ooo);
                                            console.log("////////"+JSON.stringify(ooo));
                                            var z = d3.scaleOrdinal()
                                                .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/goalkeeper.svg")
                                                .attr("x", 225)
                                                .attr("y", 630)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    d3.select("#position").append("svg")
                                                        .attr("id", "details")
                                                        .append("rect")
                                                        .attr("x", 500)
                                                        .attr("y", 0)
                                                        .attr("width", 500)
                                                        .attr("height", 700)
                                                        .style("opacity", 0.9)
                                                        .style("stroke", "black")
                                                        .style("fill", "white")
                                                        .style("stroke-width", 1);
                                                    for (let k = 0; k < listGoalkeeper.length; k++) {
                                                        console.log("[GOALKEEPER] "+listGoalkeeper[k].name);

                                                        d3.select("#position").append("text")
                                                            .attr('x', 500 + 10)
                                                            .attr('y', 10*((k*2)+5))
                                                            .attr('dy','0.35em')
                                                            .attr("fill", "red")
                                                            .attr("font-size", "20px")
                                                            .text("--->"+listGoalkeeper[k].name + " --- " + listGoalkeeper[k].caps);
                                                    }

                                                    var x0 = d3.scaleBand().rangeRound([0, 1000]).paddingInner(0.1);
                                                    var x1 = d3.scaleBand().padding(0.05);
                                                    var y = d3.scaleLinear().rangeRound([700, 0]);

                                                    x0.domain(dataset)

                                                    d3.select("#position").append("g").selectAll("ooo")
                                                })
                                                .on("mouseover", function () {
                                                    var xPosition = 50 + 225;
                                                    var yPosition = 10 + 630;
                                                    console.log("Goalkeeper ----->"+xPosition+"  -- "+yPosition);
                                                    d3.select("#position").append("svg")
                                                        .attr("id", "info")
                                                        .append("rect")
                                                        .attr("rx", 10)
                                                        .attr("ry", 10)
                                                        .attr("x", xPosition)
                                                        .attr("y", yPosition - 100)
                                                        .attr("width", 100)
                                                        .attr("height", 100)
                                                        .style("opacity", 0.9)
                                                        .style("stroke", "black")
                                                        .style("fill", "white")
                                                        .style("stroke-width", 1);
                                                    d3.select("svg#info").append("text")
                                                        .attr('x', xPosition)
                                                        .attr('y', yPosition)
                                                        .attr('dy','0.35em')
                                                        .attr("fill", "red")
                                                        .attr("font-size", "20px")
                                                        .text("Coucou");
                                                })
                                                .on("mouseout", function () {
                                                    console.log("Goalkeeper <-----");
                                                    d3.selectAll('svg#info').remove();
                                                });
                                            break;
                                        case "Defender":
                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/defender.svg")
                                                .attr("x", 40)
                                                .attr("y", 500)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    console.log("Defender");
                                                });
                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/defender.svg")
                                                .attr("x", 150)
                                                .attr("y", 530)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    console.log("Defender");
                                                });
                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/defender.svg")
                                                .attr("x", 300)
                                                .attr("y", 530)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    console.log("Defender");
                                                });
                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/defender.svg")
                                                .attr("x", 420)
                                                .attr("y", 500)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    console.log("Defender");
                                                });
                                            break;
                                        case "Midfielder":
                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/midfielder.svg")
                                                .attr("x", 40)
                                                .attr("y", 280)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    console.log("Midfielder");
                                                });
                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/midfielder.svg")
                                                .attr("x", 150)
                                                .attr("y", 370)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    console.log("Midfielder");
                                                });
                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/midfielder.svg")
                                                .attr("x", 300)
                                                .attr("y", 370)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    console.log("Midfielder");
                                                });
                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/midfielder.svg")
                                                .attr("x", 420)
                                                .attr("y", 280)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    console.log("Midfielder");
                                                });
                                            break;
                                        case "Forward":
                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/forward.svg")
                                                .attr("x", 150)
                                                .attr("y", 150)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    console.log("Forward");
                                                });
                                            d3.select("#position").append("image")
                                                .attr("xlink:href", "./img/forward.svg")
                                                .attr("x", 300)
                                                .attr("y", 150)
                                                .attr("width", 50)
                                                .attr("height", 50)
                                                .on("click", function () {
                                                    console.log("Forward");
                                                });
                                            break;
                                        default:
                                            console.log("Pas de poste remplacant");
                                    }
                                }
                            }
                        }
                    }

                } else {
                    d3.select('body').select('#team').text("Selectionne un pays");
                    d3.selectAll("svg > *").remove();
                }
            }
        });});

        document.addEventListener("DOMContentLoaded", () => {
            d3.json("./datasets/euro2016_players_dataset.json", function (dataEuro) {
                d3.json("./datasets/fifa18dataset.json", function (dataFifa) {
                    const dataViz = new DataViz("graph", dataEuro, dataFifa, 1000, 1000);
                    dataViz.draw();
                })
            })
        });

        class DataViz {
            constructor(id, datasetEuro, datasetFifa, width, height) {
                this.datasetEuro = datasetEuro;
                this.datasetFifa = datasetFifa;
                this.id = id;
                this.width = width;
                this.height = height;
                this.svg = d3.select(id).attr("width", this.width).attr("height", this.height);
            }

            draw() {

            }
        }
    </script>
</html>